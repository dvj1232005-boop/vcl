<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<meta name="theme-color" content="#9f1239">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="AnQuyChe">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:
    radial-gradient(circle at top, rgba(255,215,0,.12), transparent 60%),
    linear-gradient(180deg,#9f1239,#065f46);
  min-height:100vh;
  overflow-x:hidden;
}
.hidden{display:none}

/* ===== INTRO TET 2026 ===== */
#intro{
  position:fixed; inset:0;
  background:
    radial-gradient(circle at center, rgba(255,215,0,.25), transparent 60%),
    linear-gradient(180deg,#9f1239,#7f1d1d);
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  z-index:9999;
}
#intro img{width:150px;animation:logoIn 1.6s ease forwards}
@keyframes logoIn{from{transform:scale(.7);opacity:0}to{transform:scale(1);opacity:1}}

#intro h1{
  margin-top:18px;font-size:22px;letter-spacing:2px;
  color:#fde68a;opacity:0;
  animation:newYearIn 1.8s ease forwards;
  animation-delay:1.2s;
}
@keyframes newYearIn{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

#tetWish{
  margin-top:14px;font-size:14px;color:#fde68a;
  text-align:center;max-width:260px;line-height:1.5;
  opacity:0;filter:blur(2px);
  transition:opacity 1.2s ease, filter 1.2s ease;
}
#tetWish.show{opacity:1;filter:blur(0)}

/* ===== LI XI ===== */
.lixi{
  position:fixed;top:-60px;
  width:42px;height:56px;
  background:linear-gradient(180deg,#dc2626,#991b1b);
  border-radius:8px;
  box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 12px rgba(255,215,0,.35);
  display:flex;justify-content:center;align-items:center;
  color:#fde68a;font-size:22px;font-weight:700;
  pointer-events:none;
  animation:liXiFall 2.6s ease-in forwards,
            liXiGlow 1.4s ease-in-out infinite,
            liXiRotate 2.2s ease-in-out infinite;
}
@keyframes liXiFall{to{transform:translateY(110vh);opacity:0}}
@keyframes liXiGlow{
  0%{box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 8px rgba(255,215,0,.25)}
  50%{box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 18px rgba(255,215,0,.55)}
  100%{box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 8px rgba(255,215,0,.25)}
}
@keyframes liXiRotate{0%{transform:rotate(-4deg)}50%{transform:rotate(4deg)}100%{transform:rotate(-4deg)}}

/* ===== NOTICE ===== */
.notice-reward{background:#fef3c7;border-left:6px solid #f59e0b}
.notice-praise{background:#ecfeff;border-left:6px solid #06b6d4}
.notice-remind{background:#f0fdf4;border-left:6px solid #16a34a}
.notice-name{
  display:inline-block;background:#14532d;color:#fff;
  padding:4px 8px;border-radius:999px;
  font-size:12px;margin:4px 4px 0 0;
}

/* ===== APP UI ===== */
.container{max-width:420px;margin:auto;padding:20px}
.card{background:#fff;border-radius:22px;padding:20px;box-shadow:0 25px 50px rgba(0,0,0,.25)}
h2{margin:0 0 6px}
.sub{font-size:13px;color:#555}
input,select,textarea{
  width:100%;padding:12px;margin:8px 0;
  border-radius:14px;border:1px solid #ccc;
}
button{
  width:100%;padding:14px;border:none;
  border-radius:16px;background:#b91c1c;
  color:#fff;font-weight:600;margin-top:10px;
}
.day{font-weight:700;margin-top:14px}
.section{margin-top:18px}
.shiftBox{background:#f1f5f9;border-radius:14px;padding:10px;margin:8px 0}
.badge{display:inline-block;background:#14532d;color:#fff;padding:6px 10px;border-radius:999px;font-size:13px;margin:4px 4px 0 0}
footer{text-align:center;margin-top:16px;font-size:12px;color:#eee}
</style>
</head>

<body>

<!-- ===== INTRO ===== -->
<div id="intro">
  <img src="logo.JPG" alt="An Quy Ch·∫ø">
  <h1>CH√öC M·ª™NG NƒÇM M·ªöI 2026</h1>
  <div id="tetWish"></div>
</div>

<!-- ===== APP ===== -->
<div class="container hidden" id="app">
  <div class="card">
    <h2>ƒêƒÉng k√Ω ca l√†m</h2>
    <div id="lockStatus" class="sub"></div>

    <!-- NOTICE -->
    <div id="noticeBox" class="hidden" style="padding:14px;border-radius:14px;margin:14px 0">
      <div style="display:flex;align-items:center;gap:8px">
        <span id="noticeIcon">‚≠ê</span>
        <b id="noticeTitle"></b>
      </div>
      <div id="noticeContent" style="margin-top:6px"></div>
      <div id="noticeNames" style="margin-top:8px"></div>
    </div>

    <input id="name" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n">
    <input id="pin" placeholder="Nh·∫≠p m√£ PIN qu·∫£n l√Ω" class="hidden">

    <div id="form"></div>
    <button id="submitBtn">X√°c nh·∫≠n ƒëƒÉng k√Ω</button>
  </div>

  <!-- MANAGER -->
  <div class="card section hidden" id="managerBox">
    <h2>Qu·∫£n l√Ω</h2>
    <div id="summary"></div>

    <hr style="margin:16px 0">

    <h3>üèÖ Khen th∆∞·ªüng / Ghi nh·∫≠n tu·∫ßn</h3>
    <select id="noticeType">
      <option value="reward">‚≠ê Khen th∆∞·ªüng</option>
      <option value="praise">üëè Ghi nh·∫≠n</option>
      <option value="remind">üîî Nh·∫Øc nh·ªü t√≠ch c·ª±c</option>
    </select>

    <input id="noticeNamesInput" placeholder="T√™n nh√¢n vi√™n (c√°ch nhau b·∫±ng d·∫•u ph·∫©y)">
    <textarea id="noticeInput" placeholder="N·ªôi dung khen th∆∞·ªüng / ghi nh·∫≠n..."></textarea>

    <label style="display:flex;align-items:center;gap:6px">
      <input type="checkbox" id="noticeToggle"> Hi·ªÉn th·ªã cho nh√¢n vi√™n
    </label>

    <button id="saveNoticeBtn">üíæ L∆∞u th√¥ng b√°o tu·∫ßn</button>
    <button id="clearBtn" style="background:#444">X√≥a to√†n b·ªô l·ªãch</button>
  </div>

  <footer>¬© 2025 An Quy Ch·∫ø ‚Ä¢ ƒê√†o ƒêƒÉng T√πng</footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* FIREBASE */
const firebaseApp = initializeApp({
  apiKey:"AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  databaseURL:"https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(firebaseApp);

/* DATA */
const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=["C1","C2","C3","F1","F2","2C(C1+C2)","2C(C2+C3)"];

/* LOCK */
function isRegistrationLocked(){
  const n=new Date(),d=n.getDay(),h=n.getHours(),m=n.getMinutes();
  if(d===5&&(h>20||(h===20&&m>=0))) return true;
  if(d===6||d===0) return true;
  return false;
}
function updateLockStatus(){
  lockStatus.textContent=isRegistrationLocked()
    ?"‚õî ƒêang kh√≥a ƒëƒÉng k√Ω ‚Ä¢ M·ªü l·∫°i 00:00 Th·ª© 2"
    :"‚úÖ ƒêang m·ªü ƒëƒÉng k√Ω ‚Ä¢ Kh√≥a 20:00 Th·ª© 6";
}

/* INTRO + LI XI */
document.addEventListener("DOMContentLoaded",()=>{
  const wishes=[
    "Xu√¢n 2026 ‚Äì NƒÉm m·ªõi b√¨nh an v√† hanh th√¥ng.",
    "Ch√∫c nƒÉm m·ªõi 2026 an khang, thu·∫≠n l·ª£i.",
    "Xu√¢n m·ªõi kh·ªüi ƒë·∫ßu t·ªët ƒë·∫πp.",
    "NƒÉm m·ªõi nhi·ªÅu s·ª©c kh·ªèe v√† ni·ªÅm vui.",
    "Ch√∫c m·ªôt nƒÉm 2026 tr√≤n ƒë·∫ßy."
  ];
  tetWish.textContent=wishes[Math.floor(Math.random()*wishes.length)];
  setTimeout(()=>tetWish.classList.add("show"),600);

  for(let i=0;i<14;i++){
    const lx=document.createElement("div");
    lx.className="lixi";
    lx.textContent="üßß";
    lx.style.left=Math.random()*100+"vw";
    lx.style.animationDelay=(Math.random()*0.8)+"s";
    document.body.appendChild(lx);
    setTimeout(()=>lx.remove(),3500);
  }

  setTimeout(()=>{
    intro.remove();
    app.classList.remove("hidden");
    updateLockStatus();
    loadNotice();
  },5200);
});

/* FORM */
DAYS.forEach(d=>{
  form.innerHTML+=`<div class="day">${d}</div>
  <select id="${d}">
    <option value="">Kh√¥ng ƒëƒÉng k√Ω</option>
    ${SHIFTS.map(s=>`<option>${s}</option>`).join("")}
  </select>`;
});

/* SUBMIT */
submitBtn.onclick=async()=>{
  const ten=name.value.trim();
  if(!ten) return alert("Nh·∫≠p t√™n");

  if(ten.toLowerCase()!=="quanly"&&isRegistrationLocked())
    return alert("ƒê√£ kh√≥a ƒëƒÉng k√Ω");

  if(ten.toLowerCase()==="quanly"){
    pin.classList.remove("hidden");
    if(pin.value!=="2005") return alert("Sai PIN");
    showManager();return;
  }

  const lich={};
  DAYS.forEach(d=>{const v=document.getElementById(d).value;if(v) lich[d]=v});
  if(!Object.keys(lich).length) return alert("Ch∆∞a ch·ªçn ca");

  await set(ref(db,"dangKy/"+ten),{lich});
  alert("ƒê√£ g·ª≠i");
};

/* NOTICE */
const noticeRef=ref(db,"thongBaoTuan");

async function loadNotice(){
  const snap=await get(noticeRef);
  if(!snap.exists()) return;
  const {type,content,names,enabled}=snap.val();
  if(!enabled) return;

  noticeBox.className="";
  noticeBox.classList.add(
    type==="reward"?"notice-reward":
    type==="praise"?"notice-praise":"notice-remind"
  );

  noticeIcon.textContent=type==="reward"?"‚≠ê":type==="praise"?"üëè":"üîî";
  noticeTitle.textContent=type==="reward"?"Khen th∆∞·ªüng tu·∫ßn":type==="praise"?"Ghi nh·∫≠n tu·∫ßn":"Nh·∫Øc nh·ªü t√≠ch c·ª±c";
  noticeContent.textContent=content||"";
  noticeNames.innerHTML="";
  (names||[]).forEach(n=>{
    const s=document.createElement("span");
    s.className="notice-name";
    s.textContent=n;
    noticeNames.appendChild(s);
  });
  noticeBox.classList.remove("hidden");
}

saveNoticeBtn.onclick=async()=>{
  await set(noticeRef,{
    type:noticeType.value,
    content:noticeInput.value.trim(),
    names:noticeNamesInput.value.split(",").map(n=>n.trim()).filter(Boolean),
    enabled:noticeToggle.checked
  });
  alert("ƒê√£ l∆∞u th√¥ng b√°o tu·∫ßn");
  loadNotice();
};

/* MANAGER */
async function showManager(){
  managerBox.classList.remove("hidden");
  const snap=await get(noticeRef);
  if(snap.exists()){
    const n=snap.val();
    noticeType.value=n.type||"reward";
    noticeInput.value=n.content||"";
    noticeNamesInput.value=(n.names||[]).join(", ");
    noticeToggle.checked=!!n.enabled;
  }

  summary.innerHTML="";
  const snap2=await get(ref(db,"dangKy"));
  if(!snap2.exists()){summary.innerHTML="Ch∆∞a c√≥ d·ªØ li·ªáu";return;}
  const sum={};
  snap2.forEach(n=>{
    Object.entries(n.val().lich||{}).forEach(([d,c])=>{
      sum[d]??={}; sum[d][c]??=[];
      sum[d][c].push(n.key);
    });
  });
  DAYS.forEach(d=>{
    if(!sum[d])return;
    summary.innerHTML+=`<div class="day">${d}</div>`;
    SHIFTS.forEach(s=>{
      if(!sum[d][s])return;
      summary.innerHTML+=`<div class="shiftBox"><b>${s}</b><br>
      ${sum[d][s].map(n=>`<span class="badge">${n}</span>`).join("")}</div>`;
    });
  });
}

/* CLEAR */
clearBtn.onclick=async()=>{
  if(confirm("X√≥a to√†n b·ªô?")){
    await remove(ref(db,"dangKy"));
    location.reload();
  }
};
</script>
</body>
</html>


