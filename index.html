<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<meta name="theme-color" content="#9f1239">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="AnQuyChe">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.json">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#111;
}
.hidden{display:none}

/* ===== INTRO ===== */
#intro{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  height:100svh;
  height:100dvh;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  z-index:9999;
}
.intro-bg{
  position:absolute;
  inset:0;
  background:url("intro-bg.JPG") center/cover no-repeat;
  animation:introBgZoom 14s ease-in-out forwards;
}
@keyframes introBgZoom{
  from{transform:scale(1)}
  to{transform:scale(1.08)}
}
#intro::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.25);
}
.intro-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  z-index:2;
  transition:1.2s ease;
}
.intro-wrap img{
  width:72vw;
  max-width:320px;
}
.intro-brand{
  margin-top:14px;
  font-size:26px;
  letter-spacing:4px;
  font-weight:700;
  color:#f9d783;
}
.intro-wish{
  margin-top:10px;
  font-size:15px;
  color:#fde68a;
  opacity:0;
  filter:blur(2px);
  transition:1.2s;
}
.intro-wish.show{opacity:1;filter:none}
#intro.fade-out{
  opacity:0;
  transform:scale(1.05);
}
#intro.fade-out .intro-wrap{
  opacity:0;
  transform:translateY(12px);
}
#intro.fade-out .intro-bg{
  filter:blur(10px);
}

/* ===== APP BACKGROUND ===== */
.app-bg{
  position:fixed;
  inset:0;
  background:url("intro-bg.JPG") center/cover no-repeat;
  filter:blur(14px);
  opacity:0;
  transition:1.2s;
  z-index:0;
}
.app-bg.show{opacity:.45}

/* ===== APP ===== */
#app{
  position:relative;
  z-index:1;
  opacity:0;
  transform:scale(.98);
  transition:1s;
}
#app.show{opacity:1;transform:scale(1)}

.container{max-width:420px;margin:auto;padding:20px}
.card{
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(8px);
  border-radius:22px;
  padding:20px;
  box-shadow:0 25px 50px rgba(0,0,0,.25)
}
h2{margin:0}
.sub{font-size:13px;color:#555}
input,select{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:14px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#b91c1c;
  color:#fff;
  font-weight:600;
  margin-top:10px;
}
.day{font-weight:700;margin-top:14px}

/* ===== BANNER KHEN TH∆Ø·ªûNG CAO C·∫§P ===== */
#rewardBanner{
  position:relative;
  margin:14px 0;
  padding:10px 0;
  border-radius:18px;
  overflow:hidden;
  background:rgba(255,255,255,.18);
  backdrop-filter:blur(12px);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.25),
    0 10px 30px rgba(0,0,0,.35);
}
#rewardBanner::after{
  content:"";
  position:absolute;
  top:-50%;
  left:-60%;
  width:40%;
  height:200%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,.35),transparent);
  animation:shineSweep 6s ease-in-out infinite;
}
.reward-track{
  white-space:nowrap;
  padding-left:100%;
  animation:rewardRun 22s linear infinite;
}
#rewardText{
  font-weight:700;
  font-size:14px;
  letter-spacing:1.2px;
  padding:0 16px;
  color:#fff;
  text-shadow:0 0 6px rgba(255,255,255,.55),0 2px 4px rgba(0,0,0,.45);
}
@keyframes rewardRun{
  from{transform:translateX(0)}
  to{transform:translateX(-100%)}
}
@keyframes shineSweep{
  0%{transform:translateX(0)}
  50%{transform:translateX(220%)}
  100%{transform:translateX(220%)}
}
#rewardBanner.reward{background:rgba(245,158,11,.35)}
#rewardBanner.praise{background:rgba(6,182,212,.35)}
#rewardBanner.remind{background:rgba(34,197,94,.35)}
</style>
</head>

<body>

<div class="app-bg"></div>

<!-- INTRO -->
<div id="intro">
  <div class="intro-bg"></div>
  <div class="intro-wrap">
    <img src="logo.JPG">
    <div class="intro-brand">AN CAF√â</div>
    <div id="tetWish" class="intro-wish"></div>
  </div>
</div>

<!-- APP -->
<div class="container hidden" id="app">
  <div class="card">
    <h2>ƒêƒÉng k√Ω ca l√†m</h2>
    <div id="lockStatus" class="sub"></div>

    <div id="rewardBanner" class="hidden">
      <div class="reward-track">
        <span id="rewardText"></span>
      </div>
    </div>

    <input id="name" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n">
    <input id="pin" placeholder="PIN qu·∫£n l√Ω" class="hidden">

    <div id="form"></div>
    <button id="submitBtn">X√°c nh·∫≠n ƒëƒÉng k√Ω</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const appFB=initializeApp({
  apiKey:"AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  databaseURL:"https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=getDatabase(appFB);

const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=["C1","C2","C3","F1","F2","2C(C1+C2)","2C(C2+C3)"];

const submitBtn=nameInput=document.getElementById("submitBtn");
const nameInput=document.getElementById("name");
const pinInput=document.getElementById("pin");
const formEl=document.getElementById("form");
const lockStatus=document.getElementById("lockStatus");

const rewardBanner=document.getElementById("rewardBanner");
const rewardText=document.getElementById("rewardText");

function isLocked(){
  const d=new Date(),day=d.getDay(),h=d.getHours();
  if(day===5&&h>=20) return true;
  if(day===6||day===0) return true;
  return false;
}
function updateLock(){
  lockStatus.textContent=isLocked()
    ?"‚õî ƒê√£ kh√≥a ƒëƒÉng k√Ω ‚Ä¢ M·ªü l·∫°i Th·ª© 2"
    :"‚úÖ ƒêang m·ªü ƒëƒÉng k√Ω";
}

/* intro */
document.addEventListener("DOMContentLoaded",()=>{
  const wishes=[
    "Ch√∫c AN CAF√â nƒÉm m·ªõi ph√°t t√†i ‚Äì ph√°t l·ªôc",
    "Xu√¢n m·ªõi kh√°ch v√†o n∆∞·ªùm n∆∞·ª£p",
    "NƒÉm m·ªõi an khang th·ªãnh v∆∞·ª£ng"
  ];
  tetWish.textContent=wishes[Math.floor(Math.random()*wishes.length)];
  setTimeout(()=>tetWish.classList.add("show"),600);

  setTimeout(()=>{
    intro.classList.add("fade-out");
    app.classList.remove("hidden");
    app.classList.add("show");
    document.querySelector(".app-bg").classList.add("show");
    updateLock();
    loadBanner();
    setTimeout(()=>intro.remove(),1200);
  },5000);
});

/* form */
DAYS.forEach(d=>{
  formEl.innerHTML+=`<div class="day">${d}</div>
  <select id="${d}">
    <option value="">Kh√¥ng ƒëƒÉng k√Ω</option>
    ${SHIFTS.map(s=>`<option>${s}</option>`).join("")}
  </select>`;
});

/* submit */
submitBtn.onclick=async()=>{
  const ten=nameInput.value.trim();
  if(!ten) return alert("Nh·∫≠p t√™n");
  if(isLocked()&&ten!=="quanly") return alert("ƒê√£ kh√≥a");
  if(ten==="quanly"){
    pinInput.classList.remove("hidden");
    if(pinInput.value!=="2005") return alert("Sai PIN");
    return;
  }
  const lich={};
  DAYS.forEach(d=>{
    const v=document.getElementById(d).value;
    if(v) lich[d]=v;
  });
  await set(ref(db,"dangKy/"+ten),{lich});
  alert("ƒê√£ g·ª≠i ƒëƒÉng k√Ω");
};

/* banner */
async function loadBanner(){
  const snap=await get(ref(db,"thongBaoTuan"));
  if(!snap.exists()) return;
  const {type,content,names,enabled}=snap.val();
  if(!enabled) return;

  rewardBanner.classList.remove("reward","praise","remind","hidden");
  rewardBanner.classList.add(type);

  rewardText.textContent=
    (type==="reward"?"üèÖ VINH DANH: ":
     type==="praise"?"üëè GHI NH·∫¨N: ":"üîî ")
    +(names?.join(" ‚Ä¢ ")||"")+" ‚Äì "+(content||"");

  rewardBanner.classList.remove("hidden");
}
</script>
</body>
</html>

/* FORM */
DAYS.forEach(d=>{
  formEl.innerHTML+=`<div class="day">${d}</div>
  <select id="${d}">
    <option value="">Kh√¥ng ƒëƒÉng k√Ω</option>
    ${SHIFTS.map(s=>`<option>${s}</option>`).join("")}
  </select>`;
});

/* SUBMIT */
submitBtn.onclick=async()=>{
  const ten=nameInput.value.trim();
  if(!ten) return alert("Nh·∫≠p t√™n");

  if(ten.toLowerCase()!=="quanly" && isRegistrationLocked())
    return alert("‚õî ƒê√£ kh√≥a ƒëƒÉng k√Ω");

  if(ten.toLowerCase()==="quanly"){
    pinInput.classList.remove("hidden");
    if(pinInput.value!=="2005") return alert("Sai PIN");
    showManager();return;
  }

  const lich={};
  DAYS.forEach(d=>{
    const v=document.getElementById(d).value;
    if(v) lich[d]=v;
  });
  if(!Object.keys(lich).length) return alert("Ch∆∞a ch·ªçn ca");

  await set(ref(db,"dangKy/"+ten),{lich});
  alert("ƒê√£ g·ª≠i ƒëƒÉng k√Ω");
};

/* NOTICE */
const noticeRef=ref(db,"thongBaoTuan");

async function loadNotice(){
  const snap=await get(noticeRef);
  if(!snap.exists()) return;
  const {type,content,names,enabled}=snap.val();
  if(!enabled) return;

  noticeBox.className="";
  noticeBox.classList.add(
    type==="reward"?"notice-reward":
    type==="praise"?"notice-praise":"notice-remind"
  );
  noticeIcon.textContent=type==="reward"?"‚≠ê":type==="praise"?"üëè":"üîî";
  noticeTitle.textContent=
    type==="reward"?"Khen th∆∞·ªüng tu·∫ßn":
    type==="praise"?"Ghi nh·∫≠n tu·∫ßn":"Nh·∫Øc nh·ªü t√≠ch c·ª±c";
  noticeContent.textContent=content||"";
  noticeNames.innerHTML="";
  (names||[]).forEach(n=>{
    const s=document.createElement("span");
    s.className="notice-name";
    s.textContent=n;
    noticeNames.appendChild(s);
  });
  noticeBox.classList.remove("hidden");
}

saveNoticeBtn.onclick=async()=>{
  await set(noticeRef,{
    type:noticeType.value,
    content:noticeInput.value.trim(),
    names:noticeNamesInput.value.split(",").map(n=>n.trim()).filter(Boolean),
    enabled:noticeToggle.checked
  });
  alert("ƒê√£ l∆∞u th√¥ng b√°o tu·∫ßn");
  loadNotice();
};

/* MANAGER */
async function showManager(){
  managerBox.classList.remove("hidden");
  const snap=await get(noticeRef);
  if(snap.exists()){
    const n=snap.val();
    noticeType.value=n.type||"reward";
    noticeInput.value=n.content||"";
    noticeNamesInput.value=(n.names||[]).join(", ");
    noticeToggle.checked=!!n.enabled;
  }

  summary.innerHTML="";
  const snap2=await get(ref(db,"dangKy"));
  if(!snap2.exists()){summary.innerHTML="Ch∆∞a c√≥ d·ªØ li·ªáu";return;}
  const sum={};
  snap2.forEach(n=>{
    Object.entries(n.val().lich||{}).forEach(([d,c])=>{
      sum[d]??={}; sum[d][c]??=[];
      sum[d][c].push(n.key);
    });
  });
  DAYS.forEach(d=>{
    if(!sum[d])return;
    summary.innerHTML+=`<div class="day">${d}</div>`;
    SHIFTS.forEach(s=>{
      if(!sum[d][s])return;
      summary.innerHTML+=`<div class="shiftBox"><b>${s}</b><br>
      ${sum[d][s].map(n=>`<span class="badge">${n}</span>`).join("")}</div>`;
    });
  });
}

/* CLEAR */
clearBtn.onclick=async()=>{
  if(confirm("X√≥a to√†n b·ªô?")){
    await remove(ref(db,"dangKy"));
    location.reload();
  }
};
</script>
</body>
</html>



