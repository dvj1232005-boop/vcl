<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<!-- =====================================================
     PWA
===================================================== -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3c2d">

<!-- =====================================================
     DESIGN SYSTEM ‚Äì PROMAX
     M·ª•c ti√™u: nh·∫•t qu√°n, m·ªü r·ªông ƒë∆∞·ª£c, kh√¥ng ch·∫Øp v√°
===================================================== -->
<style>

/* =====================================================
   1. CSS RESET (g·ªçn ‚Äì ƒë·ªß ‚Äì kh√¥ng ph√°)
===================================================== */
*,*::before,*::after{
  box-sizing:border-box;
}
html,body{
  margin:0;
  padding:0;
}
body{
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* =====================================================
   2. DESIGN TOKENS (BI·∫æN G·ªêC)
   ‚Üí T·∫§T C·∫¢ UI SAU N√ÄY D√ôNG T·ª™ ƒê√ÇY
===================================================== */
:root{

  /* ===== COLOR PALETTE ===== */
  --color-bg-1:#050e0b;
  --color-bg-2:#0b3c2d;
  --color-bg-3:#124f41;

  --color-surface:rgba(255,255,255,.92);
  --color-glass:rgba(255,255,255,.15);

  --color-text-main:#0f172a;
  --color-text-muted:rgba(15,23,42,.6);

  --color-green:#1e7f6d;
  --color-red:#c62828;
  --color-gold:#f4d160;

  --color-border:rgba(255,255,255,.35);

  /* ===== SPACING SYSTEM (8px grid) ===== */
  --space-1:4px;
  --space-2:8px;
  --space-3:12px;
  --space-4:16px;
  --space-5:20px;
  --space-6:24px;
  --space-7:32px;
  --space-8:40px;

  /* ===== RADIUS ===== */
  --radius-sm:8px;
  --radius-md:14px;
  --radius-lg:20px;
  --radius-xl:28px;
  --radius-pill:999px;

  /* ===== SHADOW ===== */
  --shadow-soft:0 10px 30px rgba(0,0,0,.15);
  --shadow-strong:0 40px 80px rgba(0,0,0,.45);

  /* ===== MOTION ===== */
  --ease-main:cubic-bezier(.22,1,.36,1);
  --duration-fast:.2s;
  --duration-normal:.4s;
  --duration-slow:.7s;

  /* ===== Z-INDEX ===== */
  --z-bg:0;
  --z-snow:1;
  --z-app:2;
  --z-modal:10;
}

/* =====================================================
   3. BODY ‚Äì N·ªÄN APP
===================================================== */
body{
  font-family:-apple-system,BlinkMacSystemFont,system-ui;
  color:var(--color-text-main);
  min-height:100vh;

  background:
    radial-gradient(circle at top,
      rgba(255,255,255,.18),
      transparent 40%
    ),
    linear-gradient(135deg,
      var(--color-bg-1),
      var(--color-bg-2),
      var(--color-bg-3)
    );

  display:flex;
  justify-content:center;
  overflow-x:hidden;
}

/* =====================================================
   4. SNOW LAYER (s·∫Ω animate ·ªü PART 2)
===================================================== */
.snow{
  position:fixed;
  top:-10px;
  width:6px;
  height:6px;
  background:white;
  border-radius:50%;
  pointer-events:none;
  z-index:var(--z-snow);
}

/* =====================================================
   5. APP CONTAINER
===================================================== */
.app{
  width:100%;
  max-width:430px;
  padding:var(--space-6);
  position:relative;
  z-index:var(--z-app);
}

/* =====================================================
   6. CARD ‚Äì TRUNG T√ÇM UI
===================================================== */
.card{
  background:var(--color-surface);
  border-radius:var(--radius-xl);
  padding:var(--space-6);

  box-shadow:
    var(--shadow-strong),
    inset 0 0 0 1px rgba(255,255,255,.6);

  backdrop-filter:blur(12px);
  animation:cardEnter var(--duration-slow) var(--ease-main);
}

@keyframes cardEnter{
  from{
    opacity:0;
    transform:translateY(40px) scale(.96);
  }
  to{
    opacity:1;
    transform:none;
  }
}

/* =====================================================
   7. HEADER
===================================================== */
.header{
  margin-bottom:var(--space-4);
}
.header h1{
  margin:0;
  font-size:22px;
  letter-spacing:.3px;
}
.header .subtitle{
  margin-top:var(--space-1);
  font-size:13px;
  color:var(--color-text-muted);
}

/* =====================================================
   8. FORM ELEMENTS ‚Äì BASE
===================================================== */
input{
  width:100%;
  padding:var(--space-4);
  margin:var(--space-4) 0;

  border-radius:var(--radius-lg);
  border:1px solid var(--color-border);

  font-size:15px;
  background:rgba(255,255,255,.85);
}

input:focus{
  outline:none;
  border-color:var(--color-green);
  box-shadow:0 0 0 2px rgba(30,127,109,.25);
}

/* =====================================================
   9. TABLE SCHEDULE
===================================================== */
table{
  width:100%;
  border-collapse:collapse;
}
td{
  padding:var(--space-2) 0;
}
.day{
  font-weight:700;
}

/* =====================================================
   10. SELECT ‚Äì PILL STYLE
===================================================== */
select{
  width:100%;
  padding:var(--space-3);
  border-radius:var(--radius-pill);
  border:1px solid var(--color-border);
  background:white;

  transition:
    border-color var(--duration-fast),
    box-shadow var(--duration-fast);
}

select:not([value=""]){
  border-color:var(--color-green);
  box-shadow:0 0 0 2px rgba(30,127,109,.25);
}

/* =====================================================
   11. BUTTON ‚Äì PRIMARY
===================================================== */
button{
  width:100%;
  margin-top:var(--space-6);
  padding:var(--space-4);

  border:none;
  border-radius:var(--radius-pill);

  font-size:16px;
  font-weight:700;
  color:white;

  background:
    linear-gradient(135deg,
      #b71c1c,
      #e53935
    );

  box-shadow:0 16px 40px rgba(198,40,40,.45);

  cursor:pointer;
  transition:
    transform var(--duration-fast),
    opacity var(--duration-fast);
}

button:hover{
  transform:translateY(-1px);
}
button:active{
  transform:scale(.98);
}
button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* =====================================================
   12. MANAGER BOX ‚Äì BASE (render ·ªü PART 4)
===================================================== */
.manager-box{
  margin-top:var(--space-6);
  padding:var(--space-5);
  border-radius:var(--radius-lg);

  background:
    linear-gradient(135deg,
      rgba(255,255,255,.95),
      rgba(255,255,255,.85)
    );
}

/* =====================================================
   13. FOOTER
===================================================== */
.footer{
  margin-top:var(--space-5);
  text-align:center;
  font-size:12px;
  color:rgba(255,255,255,.75);
}

</style>
</head>

<body>

<div class="app">
  <div class="card">

    <!-- ===== HEADER ===== -->
    <div class="header">
      <h1>üéÑ ƒêƒÉng k√Ω ca l√†m</h1>
      <div class="subtitle">Tu·∫ßn hi·ªán t·∫°i ‚Ä¢ An Quy Ch·∫ø</div>
    </div>

    <!-- ===== FORM ===== -->
    <input id="nameInput" placeholder="üë§ Nh·∫≠p t√™n (Qu·∫£n l√Ω nh·∫≠p QuanLy)">

    <table id="scheduleTable"></table>

    <button id="submitBtn">üéÖ X√°c nh·∫≠n ƒëƒÉng k√Ω</button>

    <!-- Manager render -->
    <div id="managerBox" class="manager-box" style="display:none"></div>

  </div>

  <div class="footer">
    ¬© 2025 An Quy Ch·∫ø ‚Ä¢ Developed by ƒê√†o ƒêƒÉng T√πng
  </div>
</div>

<!-- =====================================================
     JS S·∫º TI·∫æP T·ª§C ·ªû PART 2
===================================================== -->
<!-- ===================== PART 2 : CORE LOGIC ===================== -->
<script type="module">
/* ============================================================
   1. TI·ªÜN √çCH TH·ªúI GIAN ‚Äì RESET ƒê·∫¶U TU·∫¶N
============================================================ */
function getMondayTimestamp(date = new Date()){
  const d = new Date(date);
  const day = d.getDay(); // 0 = CN
  const diff = (day === 0 ? -6 : 1) - day;
  d.setDate(d.getDate() + diff);
  d.setHours(0,0,0,0);
  return d.getTime();
}

function isNewWeek(){
  const lastReset = localStorage.getItem("lastReset");
  const monday = getMondayTimestamp();
  if(!lastReset || Number(lastReset) < monday){
    localStorage.setItem("lastReset", monday);
    return true;
  }
  return false;
}

/* ============================================================
   2. RESET DATA (CH·∫†Y KHI C√ì NG∆Ø·ªúI M·ªû WEB)
============================================================ */
import { remove, child, get as fbGet } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

async function resetIfNeeded(){
  if(isNewWeek()){
    try{
      await remove(ref(db, "dangKy"));
      console.log("‚úÖ Reset d·ªØ li·ªáu tu·∫ßn m·ªõi");
    }catch(e){
      console.warn("‚ö†Ô∏è Kh√¥ng reset ƒë∆∞·ª£c:", e.message);
    }
  }
}
resetIfNeeded();

/* ============================================================
   3. RENDER GIAO DI·ªÜN QU·∫¢N L√ù (B·∫¢NG T·ªîNG H·ª¢P)
============================================================ */
function renderManagerBoard(data){
  const managerBox = document.getElementById("managerBox");
  managerBox.style.display = "block";
  managerBox.innerHTML = "";

  const title = document.createElement("h3");
  title.innerText = "üìä T·ªïng h·ª£p ƒëƒÉng k√Ω theo ng√†y & ca";
  managerBox.appendChild(title);

  const map = {};

  Object.keys(data).forEach(name=>{
    const lich = data[name].lich || {};
    Object.keys(lich).forEach(day=>{
      const ca = lich[day];
      map[day] ??= {};
      map[day][ca] ??= [];
      map[day][ca].push(name);
    });
  });

  Object.keys(map).forEach(day=>{
    const dayBlock = document.createElement("div");
    dayBlock.style.marginTop = "16px";

    dayBlock.innerHTML = `<strong>${day}</strong>`;
    Object.keys(map[day]).forEach(ca=>{
      const box = document.createElement("div");
      box.style.margin = "6px 0";
      box.style.padding = "8px";
      box.style.borderRadius = "12px";
      box.style.background = "rgba(0,168,168,.08)";
      box.innerHTML = `
        <b>${ca}</b>: 
        <span>${map[day][ca].join(", ")}</span>
      `;
      dayBlock.appendChild(box);
    });

    managerBox.appendChild(dayBlock);
  });
}

/* ============================================================
   4. GHI ƒê√à SUBMIT C≈® ‚Äì TH√äM QU·∫¢N L√ù PRO
============================================================ */
window.submitSchedule = async ()=>{
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("‚ùó Ch∆∞a nh·∫≠p t√™n");

  if(name === "QuanLy"){
    const snap = await fbGet(ref(db, "dangKy"));
    if(!snap.exists()){
      alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒëƒÉng k√Ω");
      return;
    }
    renderManagerBoard(snap.val());
    return;
  }

  const lich = {};
  ["T2","T3","T4","T5","T6","T7","CN"].forEach(d=>{
    const v = document.getElementById(d).value;
    if(v) lich[d] = v;
  });

  await set(ref(db, "dangKy/" + name), {
    ten: name,
    lich,
    updatedAt: Date.now()
  });

  alert("üéâ ƒê√£ g·ª≠i ƒëƒÉng k√Ω th√†nh c√¥ng");
};

/* ============================================================
   5. TUY·∫æT R∆†I GI√ÅNG SINH ‚ùÑÔ∏è
============================================================ */
const snowContainer = document.createElement("div");
snowContainer.style.position = "fixed";
snowContainer.style.inset = "0";
snowContainer.style.pointerEvents = "none";
snowContainer.style.zIndex = "9999";
document.body.appendChild(snowContainer);

function createSnow(){
  const snow = document.createElement("div");
  snow.innerText = "‚ùÑÔ∏è";
  snow.style.position = "absolute";
  snow.style.left = Math.random()*100 + "vw";
  snow.style.fontSize = (12 + Math.random()*12) + "px";
  snow.style.opacity = Math.random();
  snow.style.top = "-20px";
  snow.style.transition = "top linear";

  snowContainer.appendChild(snow);

  const duration = 5000 + Math.random()*5000;
  setTimeout(()=>{
    snow.style.top = "110vh";
  },10);

  setTimeout(()=>{
    snow.remove();
  }, duration);
}
setInterval(createSnow, 350);

/* ============================================================
   6. AUTO THEME NOEL (TR∆Ø·ªöC 25/12)
============================================================ */
(function(){
  const now = new Date();
  if(now.getMonth() === 11 && now.getDate() <= 25){
    document.body.classList.remove("dark");
  }
})();
   /* =====================================================
   PART 3 : MANAGER DASHBOARD + GROUP SHIFT VIEW
   ===================================================== */

/* ========= 1. C·∫§U TR√öC CA & NG√ÄY ========= */
const DAY_LABELS = {
  T2: "Th·ª© 2",
  T3: "Th·ª© 3",
  T4: "Th·ª© 4",
  T5: "Th·ª© 5",
  T6: "Th·ª© 6",
  T7: "Th·ª© 7",
  CN: "Ch·ªß nh·∫≠t"
};

const SHIFT_LABELS = {
  C1: "Ca 1",
  C2: "Ca 2",
  C3: "Ca 3",
  "2C_C1_C2": "2 Ca (C1 + C2)",
  "2C_C2_C3": "2 Ca (C2 + C3)",
  F1: "Full 1",
  F2: "Full 2"
};

/* ========= 2. T·∫†O GIAO DI·ªÜN QU·∫¢N L√ù ========= */
function renderManagerBox(){
  const box = document.getElementById("managerBox");
  box.style.display = "block";
  box.innerHTML = `
    <div class="manager-panel">
      <h3>üìä B·∫£ng t·ªïng h·ª£p ƒëƒÉng k√Ω</h3>
      <div id="managerContent">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
    </div>
  `;
}

/* ========= 3. T·ªîNG H·ª¢P L·ªäCH THEO NG√ÄY / CA ========= */
function buildSummary(data){
  const summary = {};

  // Kh·ªüi t·∫°o c·∫•u tr√∫c
  days.forEach(d=>{
    summary[d] = {};
    shifts.forEach(s=>{
      summary[d][s.value] = [];
    });
  });

  // Gom d·ªØ li·ªáu
  data.forEach(emp=>{
    const lich = emp.lich || {};
    Object.keys(lich).forEach(day=>{
      const ca = lich[day];
      if(summary[day] && summary[day][ca]){
        summary[day][ca].push(emp.ten);
      }
    });
  });

  return summary;
}

/* ========= 4. RENDER B·∫¢NG QU·∫¢N L√ù ========= */
function renderManagerTable(summary){
  let html = "";

  Object.keys(summary).forEach(day=>{
    html += `
      <div class="day-block">
        <h4>üìÖ ${DAY_LABELS[day]}</h4>
    `;

    Object.keys(summary[day]).forEach(shift=>{
      const list = summary[day][shift];
      if(list.length){
        html += `
          <div class="shift-row">
            <span class="shift-name">${SHIFT_LABELS[shift]}</span>
            <span class="emp-list">${list.join(", ")}</span>
          </div>
        `;
      }
    });

    html += `</div>`;
  });

  document.getElementById("managerContent").innerHTML = html || "Ch∆∞a c√≥ d·ªØ li·ªáu";
}

/* ========= 5. LOAD D·ªÆ LI·ªÜU CHO QU·∫¢N L√ù ========= */
async function loadManagerData(){
  renderManagerBox();

  const snap = await get(ref(db,"dangKy"));
  if(!snap.exists()){
    document.getElementById("managerContent").innerText = "Ch∆∞a c√≥ ai ƒëƒÉng k√Ω";
    return;
  }

  const data = [];
  snap.forEach(n=>{
    data.push(n.val());
  });

  const summary = buildSummary(data);
  renderManagerTable(summary);
}

/* ========= 6. G·∫ÆN V√ÄO FLOW C≈® ========= */
const oldSubmit = window.submitSchedule;

window.submitSchedule = async ()=>{
  const name = document.getElementById("name").value.trim();
  if(name === "QuanLy"){
    await loadManagerData();
    return;
  }
  await oldSubmit();
};
/* ============================================================
   PART 4 ‚Äì MANAGER DASHBOARD (T·ªîNG H·ª¢P CA L√ÄM)
   ============================================================ */

/* ==== CSS cho Manager (inject b·∫±ng JS cho g·ªçn) ==== */
const managerStyle = document.createElement("style");
managerStyle.innerHTML = `
.manager-box{
  margin-top:20px;
  background:linear-gradient(135deg,#ecfeff,#ffffff);
  border-radius:18px;
  padding:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}
.manager-title{
  font-weight:700;
  font-size:18px;
  margin-bottom:12px;
}
.manager-day{
  margin-top:14px;
}
.manager-day h4{
  margin:6px 0;
  font-size:15px;
}
.shift-group{
  background:#f1f5f9;
  border-radius:12px;
  padding:10px;
  margin-bottom:8px;
}
.shift-name{
  font-weight:600;
  color:#0f766e;
  margin-bottom:6px;
}
.staff-list{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.staff{
  background:#14b8a6;
  color:white;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}
`;
document.head.appendChild(managerStyle);

/* ==== H√ÄM RENDER B·∫¢NG QU·∫¢N L√ù ==== */
async function renderManagerDashboard(){
  const box = document.getElementById("managerBox");
  box.style.display = "block";
  box.innerHTML = `<div class="manager-title">üìä T·ªïng h·ª£p ƒëƒÉng k√Ω ca</div>`;

  const snap = await get(ref(db,"dangKy"));
  if(!snap.exists()){
    box.innerHTML += "<p>Ch∆∞a c√≥ d·ªØ li·ªáu.</p>";
    return;
  }

  /* ===== T·ªî CH·ª®C D·ªÆ LI·ªÜU =====
     data[day][shift] = [ten, ten...]
  */
  const data = {};

  snap.forEach(userSnap=>{
    const { ten, lich } = userSnap.val();
    if(!lich) return;

    Object.keys(lich).forEach(day=>{
      const shift = lich[day];
      if(!data[day]) data[day] = {};
      if(!data[day][shift]) data[day][shift] = [];
      data[day][shift].push(ten);
    });
  });

  /* ===== RENDER ===== */
  Object.keys(data).forEach(day=>{
    const dayDiv = document.createElement("div");
    dayDiv.className = "manager-day";
    dayDiv.innerHTML = `<h4>üìÖ ${day}</h4>`;

    Object.keys(data[day]).forEach(shift=>{
      const group = document.createElement("div");
      group.className = "shift-group";

      group.innerHTML = `
        <div class="shift-name">‚è∞ ${shift}</div>
        <div class="staff-list">
          ${data[day][shift].map(name=>`
            <div class="staff">${name}</div>
          `).join("")}
        </div>
      `;

      dayDiv.appendChild(group);
    });

    box.appendChild(dayDiv);
  });
}

/* ==== G·∫ÆN V√ÄO LOGIC QU·∫¢N L√ù ==== */
const originalSubmit = window.submitSchedule;

window.submitSchedule = async ()=>{
  const name = document.getElementById("name").value.trim();

  if(name === "QuanLy"){
    await renderManagerDashboard();
    return;
  }

  // g·ªçi l·∫°i submit c≈© cho nh√¢n vi√™n
  await originalSubmit();
};
/* ============================================================
   PART 5 ‚Äì MANAGER PRO TOOLS
   ============================================================ */

/* ===== CONFIG S·ªê NG∆Ø·ªúI T·ªêI THI·ªÇU / CA ===== */
const REQUIRED_STAFF = {
  "C1": 2,
  "C2": 2,
  "C3": 2,
  "2C_C1_C2": 3,
  "2C_C2_C3": 3,
  "F1": 1,
  "F2": 1
};

/* ===== UI FILTER BAR ===== */
function renderManagerTools(container){
  const tools = document.createElement("div");
  tools.className = "manager-tools";
  tools.innerHTML = `
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
      <select id="filterDay">
        <option value="">üìÖ T·∫•t c·∫£ ng√†y</option>
        <option>T2</option><option>T3</option><option>T4</option>
        <option>T5</option><option>T6</option><option>T7</option><option>CN</option>
      </select>

      <select id="filterShift">
        <option value="">‚è∞ T·∫•t c·∫£ ca</option>
        <option>C1</option><option>C2</option><option>C3</option>
        <option>2C_C1_C2</option><option>2C_C2_C3</option>
        <option>F1</option><option>F2</option>
      </select>

      <button id="copyBtn">üìã Copy</button>
      <button id="exportBtn">üìÑ Export CSV</button>
    </div>
  `;
  container.appendChild(tools);
}

/* ===== N√ÇNG C·∫§P RENDER MANAGER ===== */
async function renderManagerDashboardPro(){
  const box = document.getElementById("managerBox");
  box.style.display = "block";
  box.innerHTML = `<div class="manager-title">üìä T·ªïng h·ª£p ƒëƒÉng k√Ω ca</div>`;

  renderManagerTools(box);

  const snap = await get(ref(db,"dangKy"));
  if(!snap.exists()){
    box.innerHTML += "<p>Ch∆∞a c√≥ d·ªØ li·ªáu.</p>";
    return;
  }

  const data = {};
  snap.forEach(u=>{
    const { ten, lich } = u.val();
    if(!lich) return;
    Object.keys(lich).forEach(day=>{
      const shift = lich[day];
      if(!data[day]) data[day] = {};
      if(!data[day][shift]) data[day][shift] = [];
      data[day][shift].push(ten);
    });
  });

  const content = document.createElement("div");
  box.appendChild(content);

  function renderFiltered(){
    content.innerHTML = "";
    const dFilter = document.getElementById("filterDay").value;
    const sFilter = document.getElementById("filterShift").value;

    Object.keys(data).forEach(day=>{
      if(dFilter && dFilter !== day) return;

      const dayDiv = document.createElement("div");
      dayDiv.className = "manager-day";
      dayDiv.innerHTML = `<h4>üìÖ ${day}</h4>`;

      Object.keys(data[day]).forEach(shift=>{
        if(sFilter && sFilter !== shift) return;

        const staff = data[day][shift];
        const required = REQUIRED_STAFF[shift] || 0;
        const thi·∫øu = staff.length < required;

        const group = document.createElement("div");
        group.className = "shift-group";
        if(thi·∫øu){
          group.style.border = "2px solid #ef4444";
        }

        group.innerHTML = `
          <div class="shift-name">
            ‚è∞ ${shift}
            ${thi·∫øu ? `<span style="color:#ef4444">‚ö†Ô∏è Thi·∫øu ${required - staff.length}</span>` : ""}
          </div>
          <div class="staff-list">
            ${staff.map(n=>`<div class="staff">${n}</div>`).join("")}
          </div>
        `;
        dayDiv.appendChild(group);
      });

      content.appendChild(dayDiv);
    });
  }

  renderFiltered();

  document.getElementById("filterDay").onchange = renderFiltered;
  document.getElementById("filterShift").onchange = renderFiltered;

  /* ===== COPY ===== */
  document.getElementById("copyBtn").onclick = ()=>{
    let text="";
    Object.keys(data).forEach(d=>{
      Object.keys(data[d]).forEach(s=>{
        text += `${d} - ${s}: ${data[d][s].join(", ")}\n`;
      });
    });
    navigator.clipboard.writeText(text);
    alert("ƒê√£ copy danh s√°ch üìã");
  };

  /* ===== EXPORT CSV ===== */
  document.getElementById("exportBtn").onclick = ()=>{
    let csv="Ng√†y,Ca,Nh√¢n vi√™n\n";
    Object.keys(data).forEach(d=>{
      Object.keys(data[d]).forEach(s=>{
        csv += `${d},${s},"${data[d][s].join(" | ")}"\n`;
      });
    });
    const blob = new Blob([csv],{type:"text/csv"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="lich-ca.csv";
    a.click();
  };
}

/* ===== GHI ƒê√à QU·∫¢N L√ù ===== */
window.submitSchedule = async ()=>{
  const name = document.getElementById("name").value.trim();
  if(name === "QuanLy"){
    await renderManagerDashboardPro();
    return;
  }
  await originalSubmit();
};

</script>
<!-- =================== END PART 2 =================== -->

</body>
</html>
