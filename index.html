<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Cháº¿ â€“ ÄÄƒng kÃ½ ca</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3c2d">

<style>
/* ================= ğŸ„ CHRISTMAS UI THEME ================= */
:root{
  --bg1:#071a14;
  --bg2:#0b3c2d;
  --bg3:#145a4a;
  --card:rgba(255,255,255,.92);
  --text:#0f172a;
  --accent:#c62828;
  --green:#1e7f6d;
  --border:rgba(255,255,255,.35);
}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:
    radial-gradient(circle at top,rgba(255,255,255,.18),transparent 40%),
    linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  min-height:100vh;
  display:flex;
  justify-content:center;
  color:var(--text);
  overflow-x:hidden;
}

/* ================= â„ï¸ SNOW ================= */
.snow{
  position:fixed;
  top:-10px;
  width:8px;
  height:8px;
  background:white;
  border-radius:50%;
  opacity:.9;
  pointer-events:none;
  animation: fall linear infinite;
  z-index:1;
}
@keyframes fall{to{transform:translateY(110vh)}}

/* ================= LAYOUT ================= */
.container{
  width:100%;
  max-width:420px;
  padding:20px;
  position:relative;
  z-index:2;
}

.card{
  background:var(--card);
  border-radius:26px;
  padding:22px;
  box-shadow:
    0 30px 60px rgba(0,0,0,.35),
    inset 0 0 0 1px rgba(255,255,255,.6);
  backdrop-filter:blur(10px);
}

/* ================= HEADER ================= */
.header h2{
  margin:0;
  font-size:20px;
}

/* ================= FORM ================= */
input{
  width:100%;
  padding:12px;
  margin:14px 0;
  border-radius:16px;
  border:1px solid var(--border);
  font-size:15px;
}

table{width:100%}
td{padding:8px 0}
.day{font-weight:600}

select{
  width:100%;
  padding:10px;
  border-radius:14px;
  border:1px solid var(--border);
  transition:.25s;
}
select:not([value=""]){
  border-color:var(--green);
  box-shadow:0 0 0 2px rgba(30,127,109,.25);
}

/* ================= BUTTON ================= */
button{
  margin-top:18px;
  width:100%;
  padding:15px;
  border:none;
  border-radius:20px;
  font-size:16px;
  font-weight:700;
  background:linear-gradient(135deg,#c62828,#e53935);
  color:white;
  cursor:pointer;
  box-shadow:0 14px 30px rgba(198,40,40,.4);
}
button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* ================= MANAGER VIEW ================= */
.manager-box{
  margin-top:20px;
  padding:16px;
  border-radius:18px;
  background:rgba(255,255,255,.9);
}
.manager-day{
  margin-top:14px;
  font-weight:800;
  color:var(--green);
}
.manager-shift{
  margin-left:12px;
}
.manager-count{
  font-size:12px;
  opacity:.6;
}

/* ================= FOOTER ================= */
.copyright{
  margin-top:18px;
  text-align:center;
  font-size:12px;
  opacity:.75;
}
</style>
</head>

<body>

<!-- â„ï¸ TUYáº¾T -->
<script>
for(let i=0;i<45;i++){
  const s=document.createElement("div");
  s.className="snow";
  s.style.left=Math.random()*100+"vw";
  s.style.animationDuration=6+Math.random()*6+"s";
  s.style.opacity=Math.random();
  document.body.appendChild(s);
}
</script>

<div class="container">
  <div class="card">
    <div class="header">
      <h2>ğŸ„ ÄÄƒng kÃ½ ca lÃ m</h2>
    </div>

    <input id="nameInput" placeholder="ğŸ‘¤ Nháº­p tÃªn (Quáº£n lÃ½ nháº­p QuanLy)">
    <table id="scheduleTable"></table>

    <button id="submitBtn">ğŸ… XÃ¡c nháº­n Ä‘Äƒng kÃ½</button>
    <div class="note">NgÃ y khÃ´ng lÃ m cÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng.</div>

    <div id="managerBox" class="manager-box" style="display:none"></div>
  </div>

  <div class="copyright">
    Â© 2025 An Quy Cháº¿ â€¢ Developed by ÄÃ o ÄÄƒng TÃ¹ng
  </div>
</div>

<!-- ================= LOGIC (GIá»® NGUYÃŠN) ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  authDomain: "an-quy.firebaseapp.com",
  databaseURL: "https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "an-quy",
  storageBucket: "an-quy.firebasestorage.app",
  messagingSenderId: "672469940026",
  appId: "1:672469940026:web:a38e5b15bbeb2361b84203"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=[
 {id:"C1",label:"C1"},
 {id:"C2",label:"C2"},
 {id:"C3",label:"C3"},
 {id:"2C_C1_C2",label:"2C (C1+C2)"},
 {id:"2C_C2_C3",label:"2C (C2+C3)"},
 {id:"F1",label:"F1"},
 {id:"F2",label:"F2"}
];

const table=document.getElementById("scheduleTable");
DAYS.forEach(d=>{
 table.innerHTML+=`
 <tr>
  <td class="day">${d}</td>
  <td>
   <select id="day-${d}">
    <option value="">â€” KhÃ´ng lÃ m â€”</option>
    ${SHIFTS.map(s=>`<option value="${s.id}">${s.label}</option>`).join("")}
   </select>
  </td>
 </tr>`;
});

function getWeekKey(date){
 const d=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));
 d.setUTCDate(d.getUTCDate()+4-(d.getUTCDay()||7));
 const y=new Date(Date.UTC(d.getUTCFullYear(),0,1));
 return d.getUTCFullYear()+"-W"+Math.ceil((((d-y)/86400000)+1)/7);
}
(async()=>{
 const now=new Date();
 const wk=getWeekKey(now);
 const r=ref(db,"meta/lastResetWeek");
 const s=await get(r);
 if(now.getDay()===1 && s.val()!==wk){
  await remove(ref(db,"dangKy"));
  await set(r,wk);
 }
})();

const btn=document.getElementById("submitBtn");
btn.onclick=async()=>{
 btn.disabled=true;
 const name=document.getElementById("nameInput").value.trim();
 if(!name){alert("ChÆ°a nháº­p tÃªn");btn.disabled=false;return;}

 if(name==="QuanLy"){
  const box=document.getElementById("managerBox");
  box.style.display="block";
  box.innerHTML="<strong>ğŸ“Š Tá»•ng há»£p Ä‘Äƒng kÃ½</strong>";
  const snap=await get(ref(db,"dangKy"));
  if(!snap.exists()){box.innerHTML+="<div>ChÆ°a cÃ³ dá»¯ liá»‡u</div>";btn.disabled=false;return;}
  const map={};
  snap.forEach(u=>{
    Object.entries(u.val().lich||{}).forEach(([d,c])=>{
      map[d]=map[d]||{};
      map[d][c]=map[d][c]||[];
      map[d][c].push(u.key);
    });
  });
  Object.keys(map).forEach(d=>{
    box.innerHTML+=`<div class="manager-day">ğŸ“… ${d}</div>`;
    Object.keys(map[d]).forEach(c=>{
      box.innerHTML+=`<div class="manager-shift">${c}: ${map[d][c].join(", ")} <span class="manager-count">(${map[d][c].length})</span></div>`;
    });
  });
  btn.disabled=false;
  return;
 }

 const lich={};
 DAYS.forEach(d=>{
  const v=document.getElementById("day-"+d).value;
  if(v) lich[d]=v;
 });
 await set(ref(db,"dangKy/"+name),{ten:name,lich,time:Date.now()});
 alert("ğŸ‰ Gá»­i lá»‹ch thÃ nh cÃ´ng");
 btn.disabled=false;
};

if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>


