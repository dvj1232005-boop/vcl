<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<meta name="theme-color" content="#9f1239">

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="AnQuyChe">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:
    radial-gradient(circle at top, rgba(255,215,0,.12), transparent 60%),
    linear-gradient(180deg,#9f1239,#065f46);
  min-height:100vh;
  overflow-x:hidden;
}
.hidden{display:none}

/* INTRO TET 2026 */
#intro{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at center, rgba(255,215,0,.25), transparent 60%),
    linear-gradient(180deg,#9f1239,#7f1d1d);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
  overflow:hidden;
}

#intro img{
  width:150px;
  animation:logoIn 1.6s ease forwards;
}

#intro h1{
  margin-top:18px;
  font-size:26px;
  letter-spacing:2px;
  color:#fde68a;
  opacity:0;
  animation:textIn 1.8s ease forwards;
  animation-delay:.8s;
}

#tetWish{
  margin-top:14px;
  font-size:14px;
  color:#fde68a;
  text-align:center;
  max-width:260px;
  line-height:1.5;
  opacity:0;
  filter:blur(2px);
  transition:opacity 1.2s ease, filter 1.2s ease;
}
#tetWish.show{
  opacity:1;
  filter:blur(0);
}

@keyframes logoIn{
  0%{transform:scale(.6) rotate(-8deg);opacity:0}
  60%{transform:scale(1.05) rotate(2deg);opacity:1}
  100%{transform:scale(1) rotate(0)}
}
@keyframes textIn{
  from{opacity:0;transform:translateY(12px)}
  to{opacity:1;transform:translateY(0)}
}

/* LAYOUT */
.container{max-width:420px;margin:auto;padding:20px}
.card{
  background:white;
  border-radius:22px;
  padding:20px;
  box-shadow:0 25px 50px rgba(0,0,0,.25);
}
h2{margin:0 0 6px}
.sub{font-size:13px;color:#555}

/* FORM */
input,select{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:14px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#b91c1c;
  color:white;
  font-weight:600;
  margin-top:14px;
}
.day{font-weight:700;margin-top:14px}

/* MANAGER */
.section{margin-top:18px}
.shiftBox{
  background:#f1f5f9;
  border-radius:14px;
  padding:10px;
  margin:8px 0;
}
.badge{
  display:inline-block;
  background:#14532d;
  color:white;
  padding:6px 10px;
  border-radius:999px;
  font-size:13px;
  margin:4px 4px 0 0;
}

/* HOA MAI / HOA DAO */
.flower{
  position:fixed;
  top:-10px;
  pointer-events:none;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg)}
}

/* FOOTER */
footer{text-align:center;margin-top:16px;font-size:12px;color:#eee}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <img src="logo.jpg" alt="An Quy Ch·∫ø">
  <h1>AN QUY CH·∫æ</h1>
  <div id="tetWish"></div>
</div>

<div class="container hidden" id="app">
  <div class="card">
    <h2>ƒêƒÉng k√Ω ca l√†m</h2>
    <div class="sub">Tu·∫ßn hi·ªán t·∫°i ‚Ä¢ An Quy Ch·∫ø</div>
    <div id="lockStatus" class="sub"></div>

    <input id="name" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n">
    <input id="pin" placeholder="Nh·∫≠p m√£ PIN qu·∫£n l√Ω" class="hidden">

    <div id="form"></div>
    <button id="submitBtn">X√°c nh·∫≠n ƒëƒÉng k√Ω</button>
  </div>

  <div class="card section hidden" id="managerBox">
    <h2>T·ªïng h·ª£p ƒëƒÉng k√Ω ca l√†m</h2>
    <button id="clearBtn">X√≥a to√†n b·ªô l·ªãch tu·∫ßn n√†y</button>
    <div id="summary"></div>
  </div>

  <footer>¬© 2025 An Quy Ch·∫ø ‚Ä¢ Developed by ƒê√†o ƒêƒÉng T√πng</footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* FIREBASE */
const firebaseApp = initializeApp({
  apiKey:"AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  databaseURL:"https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(firebaseApp);

/* DATA */
const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=["C1","C2","C3","F1","F2","2C(C1+C2)","2C(C2+C3)"];

/* TIME LOCK */
function isRegistrationLocked(){
  const n=new Date(),d=n.getDay(),h=n.getHours(),m=n.getMinutes();
  if(d===5&&(h>20||(h===20&&m>=0))) return true;
  if(d===6||d===0) return true;
  return false;
}
function updateLockStatus(){
  const el=document.getElementById("lockStatus");
  el.textContent=isRegistrationLocked()
    ?"‚õî ƒêang kh√≥a ƒëƒÉng k√Ω ‚Ä¢ M·ªü l·∫°i l√∫c 00:00 Th·ª© 2"
    :"‚úÖ ƒêang m·ªü ƒëƒÉng k√Ω ‚Ä¢ Kh√≥a l√∫c 20:00 Th·ª© 6";
  el.style.color=isRegistrationLocked()?"#b91c1c":"#14532d";
  el.style.fontWeight="600";
}

/* INTRO END */
setTimeout(()=>{
  document.getElementById("intro").remove();
  document.getElementById("app").classList.remove("hidden");
  updateLockStatus();
},2600);

/* HOA MAI / HOA DAO R∆†I */
setInterval(()=>{
  const f=document.createElement("div");
  f.className="flower";
  f.textContent=Math.random()>.5?"üå∏":"üåº";
  f.style.left=Math.random()*100+"vw";
  f.style.fontSize=14+Math.random()*12+"px";
  f.style.opacity=.85;
  f.style.animationDuration=5+Math.random()*4+"s";
  document.body.appendChild(f);
  setTimeout(()=>f.remove(),9000);
},500);

/* FORM */
const form=document.getElementById("form");
DAYS.forEach(d=>{
  form.innerHTML+=`
    <div class="day">${d}</div>
    <select id="${d}">
      <option value="">Kh√¥ng ƒëƒÉng k√Ω</option>
      ${SHIFTS.map(s=>`<option>${s}</option>`).join("")}
    </select>`;
});

/* SUBMIT */
document.getElementById("submitBtn").onclick=async()=>{
  const ten=document.getElementById("name").value.trim();
  const pin=document.getElementById("pin");
  if(!ten) return alert("Vui l√≤ng nh·∫≠p t√™n");

  if(ten.toLowerCase()!=="quanly" && isRegistrationLocked())
    return alert("‚õî ƒê√£ kh√≥a ƒëƒÉng k√Ω. M·ªü l·∫°i 00:00 Th·ª© 2.");

  if(ten.toLowerCase()==="quanly"){
    pin.classList.remove("hidden");
    if(pin.value!=="2005") return alert("M√£ PIN kh√¥ng ƒë√∫ng");
    showManager(); return;
  }

  const lich={};
  DAYS.forEach(d=>{
    const v=document.getElementById(d).value;
    if(v) lich[d]=v;
  });
  if(!Object.keys(lich).length) return alert("B·∫°n ch∆∞a ƒëƒÉng k√Ω ca n√†o");

  await set(ref(db,"dangKy/"+ten),{lich});
  alert("ƒê√£ g·ª≠i ƒëƒÉng k√Ω ca l√†m");
};

/* MANAGER */
async function showManager(){
  document.getElementById("managerBox").classList.remove("hidden");
  const summary=document.getElementById("summary");
  summary.innerHTML="";

  const snap=await get(ref(db,"dangKy"));
  if(!snap.exists()){
    summary.innerHTML="<p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>";
    return;
  }

  const sum={};
  snap.forEach(n=>{
    Object.entries(n.val().lich||{}).forEach(([d,c])=>{
      sum[d]??={};
      sum[d][c]??=[];
      sum[d][c].push(n.key);
    });
  });

  DAYS.forEach(d=>{
    if(!sum[d]) return;
    summary.innerHTML+=`<div class="day">${d}</div>`;
    SHIFTS.forEach(s=>{
      if(!sum[d][s]) return;
      summary.innerHTML+=`
        <div class="shiftBox">
          <b>${s}</b><br>
          ${sum[d][s].map(n=>`<span class="badge">${n}</span>`).join("")}
        </div>`;
    });
  });
}

/* RANDOM TET WISH */
const tetWishes=[
  "Ch√∫c nƒÉm m·ªõi an khang, v·∫°n s·ª± hanh th√¥ng.",
  "Xu√¢n m·ªõi kh·ªüi s·∫Øc, m·ªçi ƒëi·ªÅu nh∆∞ √Ω.",
  "NƒÉm m·ªõi s·ª©c kh·ªèe d·ªìi d√†o, c√¥ng vi·ªác thu·∫≠n l·ª£i.",
  "Ch√∫c m·ªôt nƒÉm b√¨nh an v√† nhi·ªÅu may m·∫Øn.",
  "Xu√¢n ƒë·∫øn, v·∫°n s·ª± kh·ªüi s·∫Øc.",
  "NƒÉm m·ªõi v·ªØng b∆∞·ªõc, t∆∞∆°ng lai r·ªông m·ªü.",
  "Xu√¢n an l√†nh ‚Äì T·∫øt tr·ªçn ni·ªÅm vui.",
  "Ch√∫c nƒÉm m·ªõi ƒë·ªß ƒë·∫ßy s·ª©c kh·ªèe v√† ni·ªÅm tin.",
  "NƒÉm m·ªõi kh·ªüi ƒë·∫ßu t·ªët, c·∫£ nƒÉm hanh th√¥ng.",
  "Xu√¢n m·ªõi, l√≤ng m·ªõi, h√†nh tr√¨nh m·ªõi.",
  "Ch√∫c b·∫°n nƒÉm m·ªõi l√†m vi·ªác hi·ªáu qu·∫£, s·ªëng an nhi√™n.",
  "NƒÉm m·ªõi ƒë·∫øn, mong ƒëi·ªÅu t·ªët ·ªü l·∫°i.",
  "Xu√¢n n√†y, ch√∫c m·ªçi ƒëi·ªÅu ƒë·ªÅu ƒë√∫ng l√∫c.",
  "Ch√∫c nƒÉm m·ªõi tr√≤n ƒë·∫ßy v√† v·ªØng ch·∫Øc.",
  "NƒÉm m·ªõi b√¨nh an t·ª´ trong suy nghƒ©."
];
const wishEl=document.getElementById("tetWish");
if(wishEl){
  wishEl.textContent=tetWishes[Math.floor(Math.random()*tetWishes.length)];
  setTimeout(()=>wishEl.classList.add("show"),600);
}
</script>
</body>
</html>



