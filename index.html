<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>

<meta name="theme-color" content="#9f1239">

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="AnQuyChe">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:
    radial-gradient(circle at top, rgba(255,215,0,.12), transparent 60%),
    linear-gradient(180deg,#9f1239,#065f46);
  min-height:100vh;
  overflow-x:hidden;
}
.hidden{display:none}

/* ================= INTRO TET 2026 ================= */
#intro{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at center, rgba(255,215,0,.25), transparent 60%),
    linear-gradient(180deg,#9f1239,#7f1d1d);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

#intro img{
  width:140px;
  animation:logoIn 1.6s ease forwards;
}

@keyframes logoIn{
  from{transform:scale(.7);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* ===== HORSE SVG ===== */
#horse{
  margin-top:10px;
  animation:horseMove 3.6s ease-in-out infinite;
}
#horse svg{
  filter:drop-shadow(0 0 14px rgba(255,215,0,.5));
}
@keyframes horseMove{
  0%{transform:translateX(-24px) scale(.96);opacity:.85}
  50%{transform:translateX(0) scale(1);opacity:1}
  100%{transform:translateX(24px) scale(.96);opacity:.85}
}

/* Horse legs */
.leg{
  fill:none;
  stroke:#fde68a;
  stroke-width:4;
  stroke-linecap:round;
  transform-origin:top center;
  animation:legRun .9s ease-in-out infinite;
}
.leg.back{animation-delay:.45s}
@keyframes legRun{
  0%{transform:rotate(14deg)}
  50%{transform:rotate(-14deg)}
  100%{transform:rotate(14deg)}
}

/* Mane & tail */
#mane{animation:maneWave 1.6s ease-in-out infinite;transform-origin:bottom left}
#tail{animation:tailSwing 1.4s ease-in-out infinite;transform-origin:top right}
@keyframes maneWave{0%{transform:rotate(6deg)}50%{transform:rotate(-6deg)}100%{transform:rotate(6deg)}}
@keyframes tailSwing{0%{transform:rotate(-8deg)}50%{transform:rotate(8deg)}100%{transform:rotate(-8deg)}}

/* Draw effect */
#horse path{
  stroke-dasharray:600;
  stroke-dashoffset:600;
  animation:drawHorse 2.4s ease forwards;
}
@keyframes drawHorse{to{stroke-dashoffset:0}}

/* ===== LIGHT STREAK ===== */
#lightStreak{
  animation:lightRun 2.6s ease-in-out infinite;
  opacity:.85;
}
@keyframes lightRun{
  0%{transform:translateX(-160px)}
  50%{transform:translateX(160px)}
  100%{transform:translateX(320px)}
}

/* ===== TEXT ===== */
#intro h1{
  margin-top:16px;
  font-size:22px;
  letter-spacing:2px;
  color:#fde68a;
  opacity:0;
  animation:newYearIn 1.8s ease forwards;
  animation-delay:1.2s;
}
@keyframes newYearIn{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:translateY(0)}
}

/* ===== TET WISH ===== */
#tetWish{
  margin-top:14px;
  font-size:14px;
  color:#fde68a;
  text-align:center;
  max-width:260px;
  line-height:1.5;
  opacity:0;
  filter:blur(2px);
  transition:opacity 1.2s ease, filter 1.2s ease;
}
#tetWish.show{opacity:1;filter:blur(0)}

/* ===== LI XI ===== */
.lixi{
  position:fixed;
  top:-60px;
  width:42px;
  height:56px;
  background:linear-gradient(180deg,#dc2626,#991b1b);
  border-radius:8px;
  box-shadow:
    0 8px 16px rgba(0,0,0,.25),
    0 0 12px rgba(255,215,0,.35);
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fde68a;
  font-size:22px;
  font-weight:700;
  pointer-events:none;
  animation:
    liXiFall 2.6s ease-in forwards,
    liXiGlow 1.4s ease-in-out infinite,
    liXiRotate 2.2s ease-in-out infinite;
}
@keyframes liXiFall{to{transform:translateY(110vh);opacity:0}}
@keyframes liXiGlow{
  0%{box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 8px rgba(255,215,0,.25)}
  50%{box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 18px rgba(255,215,0,.55)}
  100%{box-shadow:0 8px 16px rgba(0,0,0,.25),0 0 8px rgba(255,215,0,.25)}
}
@keyframes liXiRotate{
  0%{transform:rotate(-4deg)}
  50%{transform:rotate(4deg)}
  100%{transform:rotate(-4deg)}
}
  
/* ================= APP UI ================= */
.container{max-width:420px;margin:auto;padding:20px}
.card{background:#fff;border-radius:22px;padding:20px;box-shadow:0 25px 50px rgba(0,0,0,.25)}
h2{margin:0 0 6px}
.sub{font-size:13px;color:#555}
input,select{width:100%;padding:12px;margin:10px 0;border-radius:14px;border:1px solid #ccc}
button{width:100%;padding:14px;border:none;border-radius:16px;background:#b91c1c;color:#fff;font-weight:600;margin-top:14px}
.day{font-weight:700;margin-top:14px}
.section{margin-top:18px}
.shiftBox{background:#f1f5f9;border-radius:14px;padding:10px;margin:8px 0}
.badge{display:inline-block;background:#14532d;color:#fff;padding:6px 10px;border-radius:999px;font-size:13px;margin:4px 4px 0 0}
footer{text-align:center;margin-top:16px;font-size:12px;color:#eee}
</style>
</head>

<body>

<!-- ================= INTRO ================= -->
<div id="intro">
  <img src="logo.JPG" alt="An Quy Ch·∫ø">

  <div id="horse">
    <svg viewBox="0 0 320 200" width="160" height="100"
         xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="glow">
          <feGaussianBlur stdDeviation="4" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        <linearGradient id="horseLight" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="rgba(255,215,0,0)"/>
          <stop offset="50%" stop-color="rgba(255,215,0,.9)"/>
          <stop offset="100%" stop-color="rgba(255,215,0,0)"/>
        </linearGradient>
        <mask id="horseMask">
          <rect width="100%" height="100%" fill="black"/>
          <use href="#body" fill="white"/>
        </mask>
      </defs>

      <path id="body" d="
        M40 120 Q80 70 140 80 Q170 55 210 75
        Q255 85 280 115 L255 120
        Q230 110 205 112 Q175 115 150 125
        Q125 140 95 155 L80 150
        Q95 135 105 125 Q75 130 40 120 Z"
        fill="none" stroke="#fde68a" stroke-width="4"
        stroke-linecap="round" stroke-linejoin="round"
        filter="url(#glow)"/>

      <rect id="lightStreak" x="-120" y="40" width="120" height="140"
            fill="url(#horseLight)" mask="url(#horseMask)"/>

      <path id="mane" d="M140 80 Q155 60 175 65 Q165 75 150 90"
            fill="none" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>
      <path id="tail" d="M80 150 Q60 170 50 185"
            fill="none" stroke="#fde68a" stroke-width="3" stroke-linecap="round"/>

      <path class="leg front" d="M130 125 L125 175"/>
      <path class="leg front" d="M160 120 L165 175"/>
      <path class="leg back" d="M200 115 L195 175"/>
      <path class="leg back" d="M230 112 L235 170"/>
    </svg>
  </div>

  <h1>CH√öC M·ª™NG NƒÇM M·ªöI 2026</h1>
  <div id="tetWish"></div>
</div>

<div class="container hidden" id="app">
  <div class="card">
    <h2>ƒêƒÉng k√Ω ca l√†m</h2>
    <div id="lockStatus" class="sub"></div>
    <input id="name" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n">
    <input id="pin" placeholder="Nh·∫≠p m√£ PIN qu·∫£n l√Ω" class="hidden">
    <div id="form"></div>
    <button id="submitBtn">X√°c nh·∫≠n ƒëƒÉng k√Ω</button>
  </div>

  <div class="card section hidden" id="managerBox">
    <h2>T·ªïng h·ª£p ƒëƒÉng k√Ω</h2>
    <button id="clearBtn">X√≥a to√†n b·ªô l·ªãch</button>
    <div id="summary"></div>
  </div>

  <footer>¬© 2025 An Quy Ch·∫ø ‚Ä¢ ƒê√†o ƒêƒÉng T√πng</footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* FIREBASE */
const firebaseApp = initializeApp({
  apiKey:"AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  databaseURL:"https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(firebaseApp);

/* DATA */
const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=["C1","C2","C3","F1","F2","2C(C1+C2)","2C(C2+C3)"];

/* LOCK */
function isRegistrationLocked(){
  const n=new Date(),d=n.getDay(),h=n.getHours(),m=n.getMinutes();
  if(d===5&&(h>20||(h===20&&m>=0))) return true;
  if(d===6||d===0) return true;
  return false;
}
function updateLockStatus(){
  const el=document.getElementById("lockStatus");
  el.textContent=isRegistrationLocked()
    ?"‚õî ƒêang kh√≥a ƒëƒÉng k√Ω ‚Ä¢ M·ªü l·∫°i 00:00 Th·ª© 2"
    :"‚úÖ ƒêang m·ªü ƒëƒÉng k√Ω ‚Ä¢ Kh√≥a 20:00 Th·ª© 6";
  el.style.color=isRegistrationLocked()?"#b91c1c":"#14532d";
}

/* INTRO END + LI XI */
(function(){
  const wishes=[
    "Xu√¢n 2026 ‚Äì NƒÉm Ng·ªç, ch√∫c b·ª©t ph√° v√† ti·∫øn xa.",
    "NƒÉm m·ªõi an khang, m√£ ƒë√°o th√†nh c√¥ng.",
    "Ch√∫c nƒÉm m·ªõi 2026 m·∫°nh m·∫Ω ti·∫øn l√™n.",
    "Xu√¢n m·ªõi ‚Äì kh·ªüi ƒë·∫ßu hanh th√¥ng.",
    "NƒÉm Ng·ªç 2026, v·ªØng v√†ng v√† b·ªÅn b·ªâ."
  ];
  const wishEl=document.getElementById("tetWish");
  wishEl.textContent=wishes[Math.floor(Math.random()*wishes.length)];
  setTimeout(()=>wishEl.classList.add("show"),600);

  for(let i=0;i<14;i++){
    const lx=document.createElement("div");
    lx.className="lixi";
    lx.textContent="üßß";
    lx.style.left=Math.random()*100+"vw";
    lx.style.animationDelay=(Math.random()*0.8)+"s";
    document.body.appendChild(lx);
    setTimeout(()=>lx.remove(),3500);
  }

  setTimeout(()=>{
    document.getElementById("intro").remove();
    document.getElementById("app").classList.remove("hidden");
    updateLockStatus();
  },5200);
})();

/* FORM */
const form=document.getElementById("form");
DAYS.forEach(d=>{
  form.innerHTML+=`<div class="day">${d}</div>
  <select id="${d}">
    <option value="">Kh√¥ng ƒëƒÉng k√Ω</option>
    ${SHIFTS.map(s=>`<option>${s}</option>`).join("")}
  </select>`;
});

/* SUBMIT */
submitBtn.onclick=async()=>{
  const ten=name.value.trim();
  if(!ten) return alert("Nh·∫≠p t√™n");

  if(ten.toLowerCase()!=="quanly"&&isRegistrationLocked())
    return alert("ƒê√£ kh√≥a ƒëƒÉng k√Ω");

  if(ten.toLowerCase()==="quanly"){
    pin.classList.remove("hidden");
    if(pin.value!=="2005") return alert("Sai PIN");
    showManager();return;
  }

  const lich={};
  DAYS.forEach(d=>{const v=document.getElementById(d).value;if(v) lich[d]=v});
  if(!Object.keys(lich).length) return alert("Ch∆∞a ch·ªçn ca");

  await set(ref(db,"dangKy/"+ten),{lich});
  alert("ƒê√£ g·ª≠i");
};

/* MANAGER */
async function showManager(){
  managerBox.classList.remove("hidden");
  summary.innerHTML="";
  const snap=await get(ref(db,"dangKy"));
  if(!snap.exists()){summary.innerHTML="Ch∆∞a c√≥ d·ªØ li·ªáu";return;}
  const sum={};
  snap.forEach(n=>{
    Object.entries(n.val().lich||{}).forEach(([d,c])=>{
      sum[d]??={}; sum[d][c]??=[]; sum[d][c].push(n.key);
    });
  });
  DAYS.forEach(d=>{
    if(!sum[d])return;
    summary.innerHTML+=`<div class="day">${d}</div>`;
    SHIFTS.forEach(s=>{
      if(!sum[d][s])return;
      summary.innerHTML+=`<div class="shiftBox"><b>${s}</b><br>
      ${sum[d][s].map(n=>`<span class="badge">${n}</span>`).join("")}</div>`;
    });
  });
}

/* CLEAR */
clearBtn.onclick=async()=>{
  if(confirm("X√≥a to√†n b·ªô?")){
    await remove(ref(db,"dangKy"));
    location.reload();
  }
};
</script>
</body>
</html>



